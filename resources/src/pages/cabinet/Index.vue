<template>
    <div class="cabinet pt-30px">
        <h1 class="cabinet__hello">
            üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å,
            <b>{{ store.user.name }}</b>
        </h1>

        <div class="mt-30px">
            <div class="row g-30px">
                <div class="col-auto">
                    <div class="cabinet-block cabinet-block__mini">
                        <h4 class="cabinet-block__name">–í–∞—à —Å–∫–∏–Ω</h4>
                        <button
                            :class="
                                'cabinet-block__button fade button button__dark icon__mini ' +
                                (previewSkin ? '' : 'show')
                            "
                            @click="
                                side2dSkin ? (side2dSkin = 0) : (side2dSkin = 1)
                            "
                        >
                            <i class="icon__rotation fz-26"></i>
                        </button>
                        <div class="cabinet-block__body mb-10px gap-0">
                            <div
                                :class="
                                    'skin__2d fade ' +
                                    (previewSkin ? 'h-0' : 'show')
                                "
                            >
                                <img
                                    :src="store.skin.front"
                                    alt="front"
                                    :class="
                                        'fade ' + (side2dSkin ? 'w-0' : 'show')
                                    "
                                />
                                <img
                                    :src="store.skin.back"
                                    alt="back"
                                    :class="
                                        'fade ' + (side2dSkin ? 'show' : 'w-0')
                                    "
                                />
                            </div>
                            <div
                                :class="
                                    'skin__3d fade ' +
                                    (previewSkin ? 'show' : 'h-0')
                                "
                            >
                                <canvas id="skin_container"></canvas>
                            </div>
                        </div>
                    </div>

                    <div class="mt-30px group-button">
                        <button
                            :class="
                                'group-button__button ' +
                                (previewSkin ? 'active' : '')
                            "
                            @click="previewSkin = 1"
                        >
                            –°–∫–∏–Ω 3D
                        </button>
                        <button
                            :class="
                                'group-button__button ' +
                                (previewSkin ? '' : 'active')
                            "
                            @click="previewSkin = 0"
                        >
                            –°–∫–∏–Ω 2D
                        </button>
                    </div>
                </div>

                <div class="col">
                    <div class="cabinet-block">
                        <h4 class="cabinet-block__name">–û–±—â–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è</h4>
                        <div class="cabinet-block__body">
                            <div class="table-dotted">
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        ID –∞–∫–∫–∞—É–Ω—Ç–∞:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="copyText('#' + store.user.id)"
                                    >
                                        #{{ store.user.id }}
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –ò–≥—Ä–æ–≤–æ–π –Ω–∏–∫:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="copyText(store.user.name)"
                                    >
                                        {{ store.user.name }}
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –í–∞—à–∞ –ø–æ—á—Ç–∞:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="copyText(store.user.email)"
                                    >
                                        {{ store.user.email }}
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="
                                            copyText(
                                                dateFormat(
                                                    store.user.created_at
                                                )
                                            )
                                        "
                                    >
                                        {{ dateFormat(store.user.created_at) }}
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –ü—Ä–æ–≤–µ–¥–µ–Ω–æ –Ω–∞ –ø—Ä–æ–µ–∫—Ç–µ:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="copyText('259 –¥–Ω–µ–π')"
                                    >
                                        259 –¥–Ω–µ–π
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –ü–æ—Å–ª–µ–¥–Ω—è—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="
                                            copyText(
                                                dateFormat(
                                                    store.user.last_auth_date
                                                )
                                            )
                                        "
                                    >
                                        {{
                                            dateFormat(
                                                store.user.last_auth_date
                                            )
                                        }}
                                    </p>
                                    <!-- –ü—Ä–∏ –Ω–∞–≤–æ–¥–∫–µ –±—É–¥–µ—Ç –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å—Å—è IP –∞–¥—Ä–µ—Å -->
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        –ó–∞—â–∏—Ç–∞ 2FA:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="
                                            copyText(
                                                store.user.two_factor
                                                    ? '–ø–æ–¥–∫–ª—é—á–µ–Ω–æ'
                                                    : '–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ'
                                            )
                                        "
                                    >
                                        {{
                                            store.user.two_factor
                                                ? "–ø–æ–¥–∫–ª—é—á–µ–Ω–æ"
                                                : "–Ω–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–æ"
                                        }}
                                    </p>
                                </div>
                                <div class="table-dotted__item">
                                    <p class="table-dotted__name">
                                        HWID –±–ª–æ–∫–∏—Ä–æ–≤–∫–∞:
                                    </p>
                                    <p
                                        class="table-dotted__value icon-after"
                                        @click="
                                            copyText(
                                                store.hwid
                                                    ? '–ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç'
                                                    : '–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ'
                                            )
                                        "
                                    >
                                        {{
                                            store.hwid
                                                ? "–ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç"
                                                : "–Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–æ"
                                        }}
                                    </p>
                                </div>
                            </div>

                            <div class="row g-10px">
                                <div class="col-6">
                                    <div
                                        class="data-block data-block__broken-blocks"
                                    >
                                        <p class="data-block__text">
                                            –°–ª–æ–º–∞–Ω–æ –≤—Å–µ–≥–æ:
                                        </p>
                                        <p class="data-block__value">
                                            <b>~27–∫</b> –±–ª–æ–∫–∞
                                        </p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div
                                        class="data-block data-block__supplied-blocks"
                                    >
                                        <p class="data-block__text">
                                            –ü–æ—Å—Ç–∞–≤–ª–µ–Ω–Ω–æ –≤—Å–µ–≥–æ:
                                        </p>
                                        <p class="data-block__value">
                                            <b>~19–∫</b> –±–ª–æ–∫–æ–≤
                                        </p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="data-block data-block__deaths">
                                        <p class="data-block__text">
                                            –í–∞—Å —É–±–∏–ª–∏:
                                        </p>
                                        <p class="data-block__value">
                                            <b>17</b> —Å–º–µ—Ä—Ç–µ–π
                                        </p>
                                    </div>
                                </div>
                                <div class="col-6">
                                    <div class="data-block data-block__murders">
                                        <p class="data-block__text">
                                            –ë—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:
                                        </p>
                                        <p class="data-block__value">
                                            <b>36</b> —É–±–∏–π—Å—Ç–≤
                                        </p>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="col-auto">
                    <div class="cabinet-block cabinet-block__mini">
                        <h4 class="cabinet-block__name">–ë–∞–ª–∞–Ω—Å –∞–∫–∫–∞—É–Ω—Ç–∞</h4>
                        <button
                            @click="update"
                            class="cabinet-block__button button button__dark icon__mini"
                        >
                            <i class="icon__update"></i>
                        </button>
                        <div class="cabinet-block__body">
                            <div class="d-flex flex-column gap-10px">
                                <div class="balance balance__rubles">
                                    <p class="balance__text">–†—É–±–ª–µ–≤–æ–π —Å—á–µ—Ç:</p>
                                    <p class="balance__amount">
                                        {{ store.user.money }}‚ÇΩ
                                    </p>
                                </div>
                                <div class="balance balance__coins">
                                    <p class="balance__text">
                                        –ë–æ–Ω—É—Å—ã –Ω–∞ –±–∞–ª–∞–Ω—Å–µ:
                                    </p>
                                    <p class="balance__amount">
                                        {{ store.user.coins }}
                                        <i class="icon__coins fz-23"></i>
                                    </p>
                                </div>
                            </div>

                            <button
                                class="button button__primary"
                                @click="store.toggleModal('balance')"
                            >
                                –ü–æ–ø–æ–ª–Ω–∏—Ç—å —Ä—É–±–ª–∏
                                <i class="icon__arrow-right-button fz-12"></i>
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</template>

<script setup>
import { onMounted, ref } from "vue";
import useStore from "@/store/store";
import * as skinview3d from "skinview3d";

const store = useStore();

const previewSkin = ref(0);
const side2dSkin = ref(0);
var skinViewer = null;

function update() {
    store.updateUser();
}

function initSkin() {
    skinViewer = new skinview3d.SkinViewer({
        canvas: document.getElementById("skin_container"),
        width: 257,
        height: 342,
        skin: store.skin.file,
        cape: store.skin.cloak,
        zoom: 1,
    });

    skinViewer.animation = new skinview3d.WalkingAnimation();
    skinViewer.animation.speed = 0.8;
}

onMounted(() => {
    initSkin();
});
</script>
